@model List<tickets.Models.Ticket>

@{
    ViewData["Title"] = "Dashboard";
}

<!-- Bootstrap CSS -->
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">

<!-- Seu CSS customizado -->
<link href="~/css/dashboard.css" rel="stylesheet">

<!-- Chart.js -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<!-- Header / Navbar -->
<nav class="navbar navbar-dark bg-primary mb-3">
    <div class="container-fluid">
        <span class="navbar-brand mb-0 h1">Dashboard</span>
        <a href="/Tickets" class="btn btn-light btn-sm">Meus Tickets</a>
    </div>
</nav>

<div class="container mb-4">
    <!-- Cards de resumo -->
    <div class="row g-3 mb-3">
        <div class="col-6">
            <div class="card text-white bg-success shadow-sm">
                <div class="card-body">
                    <h5 class="card-title">Tickets Abertos</h5>
                    <p class="card-text display-6">@ViewBag.TicketsAbertos</p>
                </div>
            </div>
        </div>
        <div class="col-6">
            <div class="card text-white bg-danger shadow-sm">
                <div class="card-body">
                    <h5 class="card-title">Tickets Fechados</h5>
                    <p class="card-text display-6">@ViewBag.TicketsFechados</p>
                </div>
            </div>
        </div>
        <div class="col-6">
            <div class="card text-white bg-warning shadow-sm">
                <div class="card-body">
                    <h5 class="card-title">Tickets Pendentes</h5>
                    <p class="card-text display-6">@ViewBag.TicketsPendentes</p>
                </div>
            </div>
        </div>
        <div class="col-6">
            <div class="card text-white bg-info shadow-sm">
                <div class="card-body">
                    <h5 class="card-title">Total Tickets</h5>
                    <p class="card-text display-6">@ViewBag.TotalTickets</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Gráfico de status (menor) -->
    <div class="card mb-3 shadow-sm">
        <div class="card-body text-center">
            <h5 class="card-title">Tickets por Status</h5>
            <canvas id="statusChart" width="200" height="200"></canvas>
        </div>
    </div>

    <!-- Relatório rápido -->
    <div class="card shadow-sm">
        <div class="card-body">
            <h5 class="card-title">Últimos Tickets</h5>
            @if (Model != null && Model.Any())
            {
                <ul class="list-group list-group-flush">
                    @foreach (var ticket in Model)
                    {
                        <li class="list-group-item d-flex justify-content-between align-items-center">
                            @ticket.Titulo
                            <span class="badge @(ticket.Status == "Aberto" ? "bg-success" : ticket.Status == "Fechado" ? "bg-danger" : "bg-warning")">@ticket.Status</span>
                        </li>
                    }
                </ul>
            }
            else
            {
                <p class="text-center text-muted">Nenhum ticket encontrado.</p>
            }
        </div>
    </div>
</div>

<!-- Scripts Bootstrap -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

<!-- Chart.js -->
<script>
    const ctx = document.getElementById('statusChart').getContext('2d');
    const statusChart = new Chart(ctx, {
        type: 'doughnut',
        data: {
            labels: ['Aberto', 'Fechado', 'Pendente'],
            datasets: [{
                label: 'Tickets',
                data: [
                    @ViewBag.TicketsAbertos,
                    @ViewBag.TicketsFechados,
                    @ViewBag.TicketsPendentes
                ],
                backgroundColor: ['#28a745', '#dc3545', '#ffc107'],
                borderWidth: 1
            }]
        },
        options: {
            responsive: true,
            aspectRatio: 0.7, // gráfico menor e mais proporcional
            plugins: {
                legend: {
                    position: 'bottom',
                },
            }
        }
    });
</script>
